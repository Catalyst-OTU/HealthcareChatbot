{% extends "base.html" %}

{% block title %}Patient Portal{% endblock %}

{% block sidebar %}
<aside class="sidebar" id="sidebar">
    <button class="sidebar-toggle" id="sidebar-toggle">
        <i class="fas fa-bars"></i>
    </button>
    <div class="sidebar-header">
        <div class="logo">
            <i class="fas fa-heartbeat"></i>
            <span>Healthcare Portal</span>
        </div>
    </div>
    <div class="sidebar-profile">
        <div class="profile-icon">
            <i class="fas fa-user-injured"></i>
        </div>
        <div class="profile-info">
            <div class="profile-name">Patient</div>
            <div class="profile-role">Portal Access</div>
        </div>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-label">MAIN</div>
            <a href="/" class="nav-link active">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="/" class="nav-link" onclick="document.getElementById('track-form').scrollIntoView(); return false;">
                <i class="fas fa-search"></i>
                <span>Track Complaint</span>
            </a>
        </div>
    </nav>
</aside>
{% endblock %}

{% block header %}
<div class="page-header">
    <h1 class="page-title">Patient Portal</h1>
    <div class="header-actions">
        <button class="btn-icon" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i>
            Refresh
        </button>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Success message -->
    {% if message %}
        <div class="alert success">
            <i class="fas fa-check-circle"></i>
            {{ message }}
        </div>
    {% endif %}

    <!-- Error message -->
    {% if error %}
        <div class="alert error">
            <i class="fas fa-exclamation-circle"></i>
            {{ error }}
        </div>
    {% endif %}

    <div class="content-grid">
        <!-- Submit Complaint Card -->
        <div class="content-panel">
            <div class="panel-header">
                <h2>
                    <i class="fas fa-file-medical"></i>
                    Submit a Complaint
                </h2>
            </div>
            <form action="/web/submit" method="post" class="complaint-form modern-form">
                <div class="form-group">
                    <label>
                        <i class="fas fa-user"></i>
                        Patient Name
                    </label>
                    <input type="text" name="Patient_Name" placeholder="Enter your full name" required>
                </div>

                <div class="form-group">
                    <label>
                        <i class="fas fa-tag"></i>
                        Complaint Type
                    </label>
                    <select name="Complaint_Type" required>
                        <option value="" disabled selected>Select complaint type</option>
                        <option value="In Patient">In Patient</option>
                        <option value="Out Patient">Out Patient</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <i class="fas fa-align-left"></i>
                        Description
                    </label>
                    <textarea name="Description" rows="5" placeholder="Please provide details about your complaint..." required></textarea>
                </div>

                <button type="submit" class="btn-primary btn-block">
                    <i class="fas fa-paper-plane"></i>
                    Submit Complaint
                </button>
            </form>
        </div>

        <!-- Track Complaint Card -->
        <div class="content-panel" id="track-form">
            <div class="panel-header">
                <h2>
                    <i class="fas fa-search"></i>
                    Track a Complaint
                </h2>
            </div>
            <form action="/web/track" method="post" class="complaint-form modern-form">
                <div class="form-group">
                    <label>
                        <i class="fas fa-hashtag"></i>
                        Complaint ID
                    </label>
                    <input type="text" name="Complaint_ID" placeholder="e.g. CMP-6446" required>
                    <small class="form-hint">Enter the Complaint ID you received when you submitted your complaint</small>
                </div>

                <button type="submit" class="btn-primary btn-block">
                    <i class="fas fa-search"></i>
                    Track Complaint
                </button>
            </form>
        </div>
    </div>

    <!-- Complaint Result -->
    {% if complaint %}
        <div class="content-panel result-panel">
            <div class="panel-header">
                <h2>
                    <i class="fas fa-info-circle"></i>
                    Complaint Details
                </h2>
            </div>
            <div class="result-grid">
                <div class="result-item">
                    <div class="result-label">
                        <i class="fas fa-hashtag"></i>
                        Complaint ID
                    </div>
                    <div class="result-value">{{ complaint_id }}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">
                        <i class="fas fa-user"></i>
                        Patient Name
                    </div>
                    <div class="result-value">{{ complaint.Patient_Name }}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">
                        <i class="fas fa-tag"></i>
                        Complaint Type
                    </div>
                    <div class="result-value">{{ complaint.Complaint_Type }}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">
                        <i class="fas fa-calendar"></i>
                        Date Submitted
                    </div>
                    <div class="result-value">{{ complaint.Date_Submitted }}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">
                        <i class="fas fa-info-circle"></i>
                        Status
                    </div>
                    <div class="result-value">
                        <span class="status-badge status-{{ complaint.Status.lower().replace(' ', '-') }}">
                            {{ complaint.Status }}
                        </span>
                    </div>
                </div>
                
                <div class="result-item full-width">
                    <div class="result-label">
                        <i class="fas fa-align-left"></i>
                        Description
                    </div>
                    <div class="result-value">{{ complaint.Description }}</div>
                </div>
                
                <div class="result-item full-width">
                    <div class="result-label">
                        <i class="fas fa-comment"></i>
                        Admin Comment
                    </div>
                    <div class="result-value">
                        {{ complaint.Admin_Comment or "No comment yet. Your complaint is being reviewed." }}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Sidebar toggle functionality for patient portal
document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('sidebar');
    if (!sidebar) return;
    
    const sidebarToggle = document.createElement('button');
    sidebarToggle.className = 'sidebar-toggle';
    sidebarToggle.id = 'sidebar-toggle';
    sidebarToggle.innerHTML = '<i class="fas fa-bars"></i>';
    sidebarToggle.setAttribute('aria-label', 'Toggle sidebar');
    document.body.appendChild(sidebarToggle);
    
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    
    function handleSidebarToggle() {
        if (window.innerWidth <= 768) {
            sidebar.classList.toggle('mobile-open');
            if (sidebarOverlay) {
                sidebarOverlay.classList.toggle('active');
            }
        } else {
            sidebar.classList.toggle('collapsed');
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                if (sidebar.classList.contains('collapsed')) {
                    mainContent.style.marginLeft = '60px';
                } else {
                    mainContent.style.marginLeft = '280px';
                }
            }
        }
    }
    
    sidebarToggle.addEventListener('click', handleSidebarToggle);
    
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('mobile-open');
            sidebarOverlay.classList.remove('active');
        });
    }
    
    window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
            sidebar.classList.remove('mobile-open');
            if (sidebarOverlay) {
                sidebarOverlay.classList.remove('active');
            }
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                if (sidebar.classList.contains('collapsed')) {
                    mainContent.style.marginLeft = '60px';
                } else {
                    mainContent.style.marginLeft = '280px';
                }
            }
        }
    });
});
</script>
{% endblock %}
